============================= test session starts ==============================
platform darwin -- Python 3.13.2, pytest-8.3.5, pluggy-1.5.0
rootdir: /Users/celine/Research/librarybench
configfile: pyproject.toml
plugins: anyio-4.9.0, json-report-1.5.0, metadata-3.1.1
collected 11 items

test_doc_manager.py ..........F                                          [100%]

=================================== FAILURES ===================================
_________________________ test_activity_feed_contents __________________________

manager = <doc_manager.DocumentManager object at 0x101d8c140>

    def test_activity_feed_contents(manager):
        manager.create_document('fa', {'p': '1'})
        manager.edit('fa', 'p', '2')
>       manager.autosave('fa', 'p', '3')

test_doc_manager.py:146: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
doc_manager.py:62: in autosave
    self._queue_edit(doc, section, content, op_type='autosave')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <doc_manager.DocumentManager object at 0x101d8c140>
doc = <doc_manager.Document object at 0x101d8c8c0>, section = 'p', content = '3'
op_type = 'autosave'

    def _queue_edit(self, doc, section, content, op_type):
        if section in doc.locks:
            # conflict
            doc.conflicts.add(section)
            self._log_activity(doc.doc_id, 'conflict', {'section': section})
>           raise ConflictError(f"Section '{section}' is locked; conflict occurred")
E           doc_manager.ConflictError: Section 'p' is locked; conflict occurred

doc_manager.py:73: ConflictError
=============================== warnings summary ===============================
document_editor_technical_writer_o4-mini_iterative/test_doc_manager.py: 11 warnings
  /Users/celine/Research/librarybench/document_editor_technical_writer_o4-mini_iterative/doc_manager.py:24: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'timestamp': datetime.datetime.utcnow(),

document_editor_technical_writer_o4-mini_iterative/test_doc_manager.py: 41 warnings
  /Users/celine/Research/librarybench/document_editor_technical_writer_o4-mini_iterative/doc_manager.py:46: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'timestamp': datetime.datetime.utcnow(),

document_editor_technical_writer_o4-mini_iterative/test_doc_manager.py::test_create_and_commit_initial
document_editor_technical_writer_o4-mini_iterative/test_doc_manager.py::test_edit_and_commit
document_editor_technical_writer_o4-mini_iterative/test_doc_manager.py::test_version_compare
document_editor_technical_writer_o4-mini_iterative/test_doc_manager.py::test_undo_commit
document_editor_technical_writer_o4-mini_iterative/test_doc_manager.py::test_template_support
  /Users/celine/Research/librarybench/document_editor_technical_writer_o4-mini_iterative/doc_manager.py:97: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'timestamp': datetime.datetime.utcnow()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
--------------------------------- JSON report ----------------------------------
report saved to: report.json
=========================== short test summary info ============================
FAILED test_doc_manager.py::test_activity_feed_contents - doc_manager.Conflic...
================== 1 failed, 10 passed, 57 warnings in 0.05s ===================
