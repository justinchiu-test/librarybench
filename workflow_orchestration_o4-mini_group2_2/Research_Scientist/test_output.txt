========================================= test session starts ==========================================
platform darwin -- Python 3.13.2, pytest-8.3.5, pluggy-1.5.0
rootdir: /Users/celine/Research/librarybench
configfile: pyproject.toml
plugins: anyio-4.9.0, json-report-1.5.0, metadata-3.1.1
collected 13 items

test_auth.py ...                                                                                 [ 23%]
test_cli.py ..                                                                                   [ 38%]
test_dynamic.py F                                                                                [ 46%]
test_manager.py ...                                                                              [ 69%]
test_models.py ...                                                                               [ 92%]
test_scheduler.py .                                                                              [100%]

=============================================== FAILURES ===============================================
______________________________________ test_dynamic_task_creation ______________________________________

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x10674cc30>

    def test_dynamic_task_creation(monkeypatch):
        manager = TaskManager()
        # Create a task that generates another task
        parent = Task(id='p1', func=dynamic_creator,
                      args=(manager, 'p1'), priority=2,
                      retry_policy=RetryPolicy())
        monkeypatch.setattr(__import__('time'), 'sleep', lambda x: None)
        manager.add_task(parent)
        manager.run_all()
        # parent should have succeeded
        p = manager.get_task('p1')
        assert p.state == TaskState.SUCCESS
        assert p.result == 'p1_parent'
        # child should exist and be pending, now run it
        c = manager.get_task('p1_child')
        assert c is not None
>       assert c.state == TaskState.PENDING
E       AssertionError: assert <TaskState.SUCCESS: 'success'> == <TaskState.PENDING: 'pending'>
E        +  where <TaskState.SUCCESS: 'success'> = Task(priority=1, id='p1_child', func=<function dynamic_creator.<locals>.new_task at 0x10681c040>, args=(), kwargs={}, ...olicy(max_retries=0, retry_delay_seconds=0.0), state=<TaskState.SUCCESS: 'success'>, retries_done=0, result='p1_child').state
E        +  and   <TaskState.PENDING: 'pending'> = TaskState.PENDING

test_dynamic.py:30: AssertionError
--------------------------------------------- JSON report ----------------------------------------------
report saved to: report.json
======================================= short test summary info ========================================
FAILED test_dynamic.py::test_dynamic_task_creation - AssertionError: assert <TaskState.SUCCESS: 'succ...
===================================== 1 failed, 12 passed in 0.05s =====================================
